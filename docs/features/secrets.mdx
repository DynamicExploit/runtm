---
title: Secrets & Environment Variables
description: "Manage environment variables and secrets for deployments"
---

Declare environment variables in your manifest, store secrets locally, and Runtm injects them at deploy time.

## How it works

```mermaid
flowchart TB
    subgraph project[Your Project]
        manifest[runtm.yaml]
        envfile[.env.local]
    end
    
    manifest --> |declares schema| CLI[runtm deploy]
    envfile --> |provides values| CLI
    CLI --> API[API]
    API --> Worker[Worker]
    Worker --> Fly[Fly.io]
    
    style project fill:#f4f4f5,stroke:#18181b,stroke-width:2px
    style manifest fill:#ffffff,stroke:#18181b,stroke-width:1px,color:#18181b
    style envfile fill:#ffffff,stroke:#18181b,stroke-width:1px,color:#18181b
    style CLI fill:#f4f4f5,stroke:#18181b,stroke-width:1px,color:#18181b
    style API fill:#f4f4f5,stroke:#18181b,stroke-width:1px,color:#18181b
    style Worker fill:#f4f4f5,stroke:#18181b,stroke-width:1px,color:#18181b
    style Fly fill:#18181b,stroke:#18181b,stroke-width:2px,color:#fafafa
```

<Note>
Secrets are **never stored** in Runtm's database. Values pass directly from your machine to Fly.io.
</Note>

## Declaring environment variables

Define env vars in `runtm.yaml`:

```yaml
env_schema:
  - name: DATABASE_URL
    type: url
    required: true
    secret: true
    description: "PostgreSQL connection string"
  
  - name: STRIPE_API_KEY
    type: string
    required: true
    secret: true
    description: "Stripe secret key"
  
  - name: LOG_LEVEL
    type: string
    required: false
    default: "info"
    description: "Logging verbosity"
```

### Field reference

| Field | Type | Description |
|-------|------|-------------|
| `name` | string | Variable name (UPPER_SNAKE_CASE) |
| `type` | enum | `string`, `url`, `number`, `boolean` |
| `required` | boolean | Deployment fails without it |
| `secret` | boolean | Redact from logs |
| `description` | string | Human-readable description |
| `default` | string | Default value (not allowed for secrets) |

## Managing secrets

### Set a secret

```bash
runtm secrets set DATABASE_URL=postgres://user:pass@host:5432/db
```

Secrets are stored in `.env.local` in your project directory.

### List secrets

```bash
runtm secrets list
```

```
Environment Variables

  NAME           TYPE     REQUIRED  SECRET  STATUS
  DATABASE_URL   url      ✓         ✓       ● set
  STRIPE_API_KEY string   ✓         ✓       ● set
  LOG_LEVEL      string   -         -       ○ default (info)
```

### Get / remove

```bash
runtm secrets get DATABASE_URL
runtm secrets unset OLD_API_KEY
```

## Security

### Automatic protection

`.env.local` is automatically added to both `.gitignore` and `.cursorignore`:

```gitignore
# Secrets - DO NOT COMMIT
.env.local
```

This means:
- Secrets are never committed to git
- AI assistants cannot read secret values

### Log redaction

Secrets marked `secret: true` appear as `[REDACTED]` in logs:

```
Setting environment variables...
  DATABASE_URL = [REDACTED]
  LOG_LEVEL = info
```

## Connections

Group related env vars as named connections:

```yaml
env_schema:
  - name: SUPABASE_URL
    type: url
    required: true
  - name: SUPABASE_ANON_KEY
    type: string
    required: true
    secret: true

connections:
  - name: supabase
    env_vars: [SUPABASE_URL, SUPABASE_ANON_KEY]
```

Connections help organize which env vars belong together.

## Using in code

<Tabs>
  <Tab title="Python">
    ```python
    import os

    DATABASE_URL = os.environ.get("DATABASE_URL", "sqlite:///./data/app.db")
    STRIPE_API_KEY = os.environ["STRIPE_API_KEY"]
    ```
    
    Or with Pydantic:
    
    ```python
    from pydantic_settings import BaseSettings

    class Settings(BaseSettings):
        database_url: str = "sqlite:///./data/app.db"
        stripe_api_key: str

    settings = Settings()
    ```
  </Tab>
  <Tab title="Node.js">
    ```typescript
    // Server-side
    const STRIPE_API_KEY = process.env.STRIPE_API_KEY!;

    // Client-side (must prefix with NEXT_PUBLIC_)
    const API_URL = process.env.NEXT_PUBLIC_API_URL;
    ```
  </Tab>
</Tabs>

## Troubleshooting

<AccordionGroup>
  <Accordion title="Missing required environment variable">
    Set the missing variable:
    ```bash
    runtm secrets set VAR_NAME=value
    ```
  </Accordion>
  <Accordion title="Secret env var cannot have default">
    Secrets can't have defaults. Remove the `default` field:
    ```yaml
    - name: API_KEY
      secret: true
      required: true  # no default
    ```
  </Accordion>
  <Accordion title="Secret value not updating">
    Redeploy after changing secrets:
    ```bash
    runtm deploy
    ```
  </Accordion>
</AccordionGroup>
